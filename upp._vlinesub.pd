#N canvas 159 87 460 387 10;
#X obj 42 105 inlet;
#X obj 42 337 outlet;
#N canvas 0 22 316 296 business 0;
#X obj 42 165 upp.dilemma;
#X obj 105 123 tgl 15 0 empty empty busy 17 7 0 10 -262144 -1 -1 0
1;
#X obj 42 187 t a b;
#X msg 94 96 1;
#X obj 42 49 inlet;
#X obj 42 228 outlet;
#X obj 120 229 outlet;
#X obj 130 50 inlet;
#X msg 130 96 0;
#X obj 130 73 t b;
#X obj 197 48 loadbang;
#X obj 198 228 outlet;
#X text 131 34 free;
#X text 46 30 message;
#X text 41 250 onward;
#X text 119 251 to self;
#X text 199 247 busy state;
#X obj 105 141 t a a;
#X obj 198 204 change -1;
#X connect 0 0 2 0;
#X connect 0 1 5 0;
#X connect 1 0 17 0;
#X connect 2 0 6 0;
#X connect 2 1 3 0;
#X connect 3 0 1 0;
#X connect 4 0 0 0;
#X connect 7 0 9 0;
#X connect 8 0 1 0;
#X connect 9 0 8 0;
#X connect 10 0 8 0;
#X connect 17 0 18 0;
#X connect 17 1 0 1;
#X connect 18 0 11 0;
#X restore 42 143 pd business;
#X obj 117 144 tgl 15 0 empty empty busy 17 7 0 10 -262144 -1 -1 0
1;
#X obj 105 120 r \$0-free;
#X obj 105 165 s \$0-busy;
#X text 46 319 forward message;
#X obj 241 177 change -1;
#X obj 241 199 sel 1;
#X obj 241 223 s \$0-free;
#N canvas 203 364 311 267 running 0;
#X obj 46 40 inlet;
#X obj 147 37 inlet;
#X text 140 17 blocksize;
#X text 47 21 start;
#X obj 46 139 upp.delay;
#X obj 46 66 t b b;
#X obj 185 220 outlet;
#X msg 185 140 0;
#X obj 185 186 f;
#X obj 229 186 + 64;
#X obj 110 140 spigot;
#X obj 221 38 r \$0-busy;
#X connect 0 0 5 0;
#X connect 1 0 9 1;
#X connect 1 0 4 2;
#X connect 1 0 4 1;
#X connect 4 0 8 0;
#X connect 4 0 10 0;
#X connect 5 0 4 0;
#X connect 5 1 7 0;
#X connect 7 0 8 0;
#X connect 8 0 6 0;
#X connect 8 0 9 0;
#X connect 9 0 8 1;
#X connect 10 0 4 0;
#X connect 11 0 10 1;
#X restore 73 269 pd running offset;
#X obj 73 291 s \$0-offset;
#X obj 241 154 > 0;
#X obj 241 128 r \$0-offset;
#N canvas 86 436 563 403 init 0;
#X text 196 96 del;
#X obj 262 117 s \$0-startval;
#X obj 40 122 s \$0-target;
#X obj 128 122 s \$0-dur;
#X text 286 174 stop;
#X obj 189 150 t a b a b;
#X msg 223 219 1;
#X msg 257 219 0;
#X obj 241 240 s \$0-lock;
#X obj 114 180 +;
#X obj 40 76 unpack 0 0 0 0 0, f 50;
#X text 125 95 dur;
#X text 270 98 start;
#X obj 40 31 inlet;
#X obj 337 275 outlet;
#X text 29 95 target value;
#X obj 223 174 s \$1-stop;
#X obj 214 276 s \$0-slopestart;
#X obj 125 276 s \$0-slopeend;
#X obj 41 275 s \$0-stoppos;
#X obj 114 202 t a a;
#X obj 188 354 s \$0-startpos;
#X obj 188 332 *;
#X obj 218 309 r \$1-busy;
#X text 248 332 if we are the only voice \, set \$0-startpos to 0;
#X text 329 99 blocklen;
#X obj 41 240 + 1e+38;
#X obj 218 331 > 1;
#X connect 5 0 9 1;
#X connect 5 0 17 0;
#X connect 5 0 22 0;
#X connect 5 1 6 0;
#X connect 5 2 16 0;
#X connect 5 3 7 0;
#X connect 6 0 8 0;
#X connect 7 0 8 0;
#X connect 9 0 20 0;
#X connect 10 0 2 0;
#X connect 10 1 3 0;
#X connect 10 1 9 0;
#X connect 10 2 5 0;
#X connect 10 3 1 0;
#X connect 10 4 14 0;
#X connect 13 0 10 0;
#X connect 20 0 26 0;
#X connect 20 1 18 0;
#X connect 22 0 21 0;
#X connect 23 0 27 0;
#X connect 26 0 19 0;
#X connect 27 0 22 1;
#X restore 100 231 pd init;
#N canvas 252 77 535 581 DSP 0;
#X obj 31 61 switch~;
#X obj 133 137 upp.endless_ramp_up~;
#X obj 31 34 r \$0-busy;
#X obj 418 33 r \$0-dur;
#X obj 133 331 clip~ 0 1;
#X obj 133 452 +~ 0;
#X obj 133 420 *~ 0;
#X obj 249 384 r \$0-startval;
#X obj 171 384 r \$0-target;
#X obj 171 419 -;
#X obj 261 501 *~;
#X text 372 366 mask for this part;
#X text 132 17 tick;
#X obj 133 32 r \$0-offset;
#X obj 147 190 -;
#X obj 133 56 t b a;
#X obj 133 211 +~;
#X obj 261 528 throw~ \$1-out;
#X obj 280 31 r \$0-slopestart;
#N canvas 82 218 390 532 partmask 0;
#X obj 49 39 inlet~;
#X obj 114 40 inlet;
#X obj 58 446 *~;
#X obj 189 173 -;
#X obj 189 133 t b a;
#X text 219 172 offset-stoppos;
#X obj 189 199 * -1;
#X obj 102 224 expr~ $v1 < $f2;
#X obj 189 113 r \$0-stoppos;
#X obj 97 409 expr~ $v1 >= $f2;
#X obj 190 321 r \$0-startpos;
#X obj 190 367 -;
#X obj 190 344 t b a;
#X obj 190 388 * -1;
#X obj 58 483 outlet~;
#X connect 0 0 7 0;
#X connect 0 0 9 0;
#X connect 1 0 3 0;
#X connect 1 0 11 0;
#X connect 2 0 14 0;
#X connect 3 0 6 0;
#X connect 4 0 3 0;
#X connect 4 1 3 1;
#X connect 6 0 7 1;
#X connect 7 0 2 0;
#X connect 8 0 4 0;
#X connect 9 0 2 1;
#X connect 10 0 12 0;
#X connect 11 0 13 0;
#X connect 12 0 11 0;
#X connect 12 1 11 1;
#X connect 13 0 9 1;
#X restore 370 386 pd partmask;
#N canvas 0 22 318 271 step 0;
#X obj 74 42 inlet~;
#X obj 74 207 outlet~;
#X obj 88 144 == 0;
#X obj 74 164 *~;
#X obj 74 97 expr~ $v1 >= 0;
#X obj 171 40 inlet;
#X connect 0 0 4 0;
#X connect 2 0 3 1;
#X connect 3 0 1 0;
#X connect 4 0 3 0;
#X connect 5 0 2 0;
#X restore 174 291 pd step;
#N canvas 0 22 262 256 slope 0;
#X obj 55 33 inlet~;
#X obj 54 151 *~ 0;
#X obj 137 67 sel 0;
#X msg 137 87 0;
#X msg 169 87 1 \$1;
#X obj 169 108 /;
#X obj 137 33 inlet;
#X obj 54 195 outlet~;
#X connect 0 0 1 0;
#X connect 1 0 7 0;
#X connect 2 0 3 0;
#X connect 2 1 4 0;
#X connect 3 0 1 1;
#X connect 4 0 5 0;
#X connect 5 0 1 1;
#X connect 6 0 2 0;
#X restore 83 290 pd slope;
#X text 93 272 either;
#X text 188 272 or;
#X text 136 120 unity ramp;
#X text 79 365 transposing to value range;
#X connect 1 0 16 0;
#X connect 1 0 19 0;
#X connect 2 0 0 0;
#X connect 3 0 20 1;
#X connect 3 0 21 1;
#X connect 4 0 6 0;
#X connect 5 0 10 0;
#X connect 6 0 5 0;
#X connect 7 0 5 1;
#X connect 7 0 9 1;
#X connect 8 0 9 0;
#X connect 9 0 6 1;
#X connect 10 0 17 0;
#X connect 13 0 15 0;
#X connect 14 0 16 1;
#X connect 15 0 1 0;
#X connect 15 1 14 0;
#X connect 15 1 19 1;
#X connect 16 0 20 0;
#X connect 16 0 21 0;
#X connect 18 0 14 1;
#X connect 19 0 10 1;
#X connect 20 0 4 0;
#X connect 21 0 4 0;
#X restore 242 284 pd DSP;
#N canvas 0 22 395 368 stop 0;
#X obj 30 73 spigot 0;
#X obj 89 73 r \$0-busy;
#X obj 89 99 r \$0-lock;
#X obj 30 98 spigot 1;
#X text 48 131 we are stopped from outside;
#X text 46 148 -> update stop position;
#X obj 30 47 r \$1-stop;
#X obj 30 254 min;
#X obj 63 227 r \$0-stoppos;
#X obj 63 322 s \$0-stoppos;
#X obj 30 289 select;
#X text 77 306 output on change;
#X obj 30 202 +;
#X obj 45 178 r \$0-offset;
#X obj 209 256 min;
#X obj 209 291 select;
#X text 256 308 output on change;
#X obj 242 229 r \$0-slopeend;
#X obj 242 324 s \$0-slopeend;
#X text 28 24 Stop signal by other voice (sample delay from now);
#X connect 0 0 3 0;
#X connect 1 0 0 1;
#X connect 2 0 3 1;
#X connect 3 0 12 0;
#X connect 6 0 0 0;
#X connect 7 0 10 0;
#X connect 8 0 7 1;
#X connect 8 0 10 1;
#X connect 10 1 9 0;
#X connect 12 0 7 0;
#X connect 12 0 14 0;
#X connect 13 0 12 1;
#X connect 14 0 15 0;
#X connect 15 1 18 0;
#X connect 17 0 14 1;
#X connect 17 0 15 1;
#X restore 154 231 pd stop;
#X obj 320 128 r \$0-slopeend;
#X obj 73 193 t b a;
#X text 240 110 signal end after slope end;
#X text 41 13 This is used in upp.vline~;
#X text 41 28 It plays one ramp segment;
#N canvas 0 22 225 200 incdec_voices 0;
#X obj 37 24 r \$0-busy;
#X obj 37 48 change -1;
#X obj 37 70 sel 0 1;
#X obj 37 124 +;
#X msg 37 92 -1;
#X msg 68 92 1;
#X obj 68 125 max 0;
#X obj 37 159 s \$1-busy;
#X obj 121 24 r \$1-busy;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 2 0 4 0;
#X connect 2 1 5 0;
#X connect 3 0 6 0;
#X connect 3 0 7 0;
#X connect 4 0 3 0;
#X connect 5 0 3 0;
#X connect 6 0 3 1;
#X connect 8 0 3 1;
#X restore 241 336 pd incdec_voices;
#X text 239 266 actual synthesis;
#X text 239 318 increment/decrement busy voices;
#X text 42 50 grrrr.org 2016;
#X text 39 84 targetval dur delay startval blocksize;
#X connect 0 0 2 0;
#X connect 2 0 1 0;
#X connect 2 1 18 0;
#X connect 2 2 3 0;
#X connect 2 2 5 0;
#X connect 4 0 2 1;
#X connect 7 0 8 0;
#X connect 8 0 9 0;
#X connect 10 0 11 0;
#X connect 12 0 7 0;
#X connect 13 0 12 0;
#X connect 14 0 10 1;
#X connect 17 0 12 1;
#X connect 18 0 10 0;
#X connect 18 1 14 0;
